<!doctype html>
<html>
<head>
<meta http-equiv="Content-Type" content="charset=UTF-8"/>


<link rel="stylesheet" type="text/css" href="css/myClock.css">

</head>
<body>
<div id="screen">
	<div id="clockContaniner">
		<div id="clock">
			<canvas id="myClockDial" width="200" height="200"></canvas>
			<canvas id="myClockHand" width="200" height="200"></canvas>
		</div>
		<div id="digTime"><p id="timeTxt"></p><p id="location">北京</p></div>
	</div>
	<div id="alarm">
		<table cellpadding="0	">
			<tr>
				<td><p>闹钟</p>
				<a onclick="newAlarm()">添加闹钟</a></td>
			</tr>
			<tr>
				<td valign="top">
				<div id="alarmContainer" >
					<!--div class="myAlarm">
						<div class="leftIcon"></div>
						<div class="alarmTime">09:24</div>
						<div class="alarmInfo"><p>闹钟</p><p class="alarmInfoTime">14个小时后</p><p>工作日</p></div>
						<div class="rightIcon"></div>
					</div--><!--demo-->


				</div>
				</td>
			</tr>
		</table>
	</div>
</div>
<input type="button" value="clear" onclick="clearData()"/>




<script type="text/javascript" src="js/time/timeCaculate.js"></script>
<script type="text/javascript" src="js/drawClockDial.js"></script>
<script type="text/javascript" src="js/drawClockHand.js"></script>
<script type="text/javascript" src="js/drawClock.js"></script>
<script type="text/javascript" src="js/passData.js"></script>
<script type="text/javascript">
	
	var screen0 = document.getElementById("screen");
	var alarmContainer = document.getElementById("alarmContainer");





/*实时监测闹钟*/
function refreshAlarm(){
	if(document.getElementsByClassName("alarmTime")){
		var alarmTimeEles = document.getElementsByClassName("alarmTime");
		var alarmInfoEles = document.getElementsByClassName("alarmInfoTime");
		for(var i = 0;i<alarmTimeEles.length;i++){

		 var tmp = alarmTimeEles[i].innerHTML.split(":");
		 var alarmTime = {};

		 alarmTime['hours'] = parseInt(tmp[0]);
		 alarmTime['minutes'] = parseInt(tmp[1]);

		 var dTime = timeDvalue(alarmTime['hours'], alarmTime['minutes']);

		 if (dTime.hours == 0 && dTime.minutes == 0){
		 	var currentTime = getTimes();
		 	if(currentTime.seconds == 0){
		 		alert("Ding Ding Ding ~~");
		 	}
		 }
		 if(dTime.hours == 0||dTime.minutes == 0){
			if(dTime.hours == 0){
					alarmInfoEles[i].innerHTML = dTime.minutes+"分钟后";
			}
			if(dTime.minutes == 0){
					alarmInfoEles[i].innerHTML = dTime.hours+"小时后";
			}
		}
		else{
			alarmInfoEles[i].innerHTML = dTime.hours+"小时"+dTime.minutes+"分钟后";
		}
		}
	}
}
setInterval("refreshAlarm()",1000);


//加载页面时读取闹钟数据


function alarmDiv(alarmTime,countDown,pickInfo,isOn,num){
	this.alarmTime = alarmTime;
	this.countDown = countDown;
	this.pickInfo = pickInfo;
	this.isOn = isOn;
	this.num = num;
	this.domEle = document.createElement('div');
	this.domEle.className = "myAlarm";
	this.changeAlarm = function(){//点击右边div 进入alarm页面
		setNum(num);
		window.location.href = "addAlarm.html";
	}
}

alarmDiv.prototype.showObj = function(){//在页面上生成元素

	
	/*创建div容器内四个元素*/
	var leftIconEle = document.createElement("div");
	leftIconEle.className = "leftIcon";
	leftIconEle.onclick =  changeOn;

	var alarmTimeEle = document.createElement("div");
	alarmTimeEle.className = "alarmTime";
	var alarmInfoEle = document.createElement("div");
	alarmInfoEle.className = "alarmInfo";
	var rightIconEle = document.createElement("div");
	rightIconEle.className = "rightIcon";
	rightIconEle.onclick = this.changeAlarm;
	/*为容器内元素添加内容*/

	alarmTimeEle.innerHTML = this.alarmTime;
	alarmInfoEle.innerHTML = "<p>闹钟</p><p class='alarmInfoTime'>"+this.countDown+"后</p><p>"+this.pickInfo+"</p>";
	/*添加至页面容器内*/
	var alarmContainer = document.getElementById("alarmContainer");
	this.domEle.appendChild(leftIconEle);
	this.domEle.appendChild(alarmTimeEle);
	this.domEle.appendChild(alarmInfoEle);
	this.domEle.appendChild(rightIconEle);
	alarmContainer.appendChild(this.domEle);
}


function init(){
  if(getData()){
		var data = getData();

		//获取数据 并分割成数组
		var alarmTime = data["alarmTime"].split(",");
		var countDown = data["countDown"].split(",");
		var pickInfo = data["pickInfo"].split(",");
		var isOn = data["isOn"].split(",");

		 newEle = new Array();
		for(var i = 0 ; i<alarmTime.length;i++){
			newEle[i] = new alarmDiv(alarmTime[i],countDown[i],pickInfo[i],isOn[i],i);
			newEle[i].showObj();
		}
	}
}

init();//初始化完成，加载页面闹钟数据完成



function changeOn(){
	alert("click left");
}
/*function changeAlarm(index){//已经存在的闹钟，传递index判断其值
	alert(index);
	setNum(index);
	window.location.href = "addAlarm.html";
}*/
function newAlarm(){//新闹钟，则赋值index为-1
	setNum(-1);
	window.location.href = "addAlarm.html";
}
</script>
</body>
</html>